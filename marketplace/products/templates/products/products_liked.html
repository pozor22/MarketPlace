{% extends 'products/base.html' %}

{% block title %} {{ title }} {% endblock %}

{% block style %}
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'products/products_liked.css' %}">
{% endblock %}

{% block main %}
<div class="products-container">
    <h1>Мои лайкнутые товары</h1>
    <div class="products-list">
      {% for product in products %}
        <div class="product-card">
          <!-- Слайдер -->
          <div class="product-slider" id="slider-{{ product.id }}">
            {% for image in product.images.all %}
              <div class="slider-item">
                <img
                  src="data:image/png;base64,{{ image.get_image_base64 }}"
                  alt="{{ product.name }}"
                  class="product-image"
                >
              </div>
            {% empty %}
              <div class="slider-item">
                <p>Нет изображений</p>
              </div>
            {% endfor %}
          </div>
          <a href="{% url 'product_detail' product.id %}" class="product-card-link">
          <h3>{{ product.name }}</h3>
          <p>{{ product.description }}</p>
          <p>Категория: {{ product.category.name }}</p>
          {% if product.get_ratings %}
            <p class="product-price"> Оценка {{ product.get_ratings|floatformat:1 }} / 5</p>
          {% else %}
            <p class="product-price"> Нет оценок</p>
          {% endif %}
          <p class="product-price">Цена: {{ product.price }}₽</p>
          <p class="product-author">Автор: {{ product.author.username }}</p>
          </a>
        </div>
      {% empty %}
        <p>Нет доступных товаров.</p>
      {% endfor %}
    </div>

    <!-- Пагинация -->
    <div class="pagination">
      {% if page_obj.has_previous %}
        <a href="?page=1">&laquo; Первая</a>
        <a href="?page={{ page_obj.previous_page_number }}">Предыдущая</a>
      {% endif %}

      <span>Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>

      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}">Следующая</a>
        <a href="?page={{ page_obj.paginator.num_pages }}">Последняя &raquo;</a>
      {% endif %}
    </div>
  </div>
{% endblock %}

{% block script %}
<!-- Подключение слайдера -->
  <script>
    // Пример простого слайдера на чистом JS
    document.querySelectorAll('.product-slider').forEach(slider => {
      let currentIndex = 0;
      const items = slider.querySelectorAll('.slider-item');

      function showSlide(index) {
        items.forEach((item, i) => {
          item.style.display = i === index ? 'block' : 'none';
        });
      }

      showSlide(currentIndex);

      // Добавьте кнопки для управления (вперед/назад)
      const nextButton = document.createElement('button');
      nextButton.innerText = 'Вперед';
      nextButton.onclick = () => {
        currentIndex = (currentIndex + 1) % items.length;
        showSlide(currentIndex);
      };

      const prevButton = document.createElement('button');
      prevButton.innerText = 'Назад';
      prevButton.onclick = () => {
        currentIndex = (currentIndex - 1 + items.length) % items.length;
        showSlide(currentIndex);
      };

      slider.appendChild(prevButton);
      slider.appendChild(nextButton);
    });
  </script>
{% endblock %}